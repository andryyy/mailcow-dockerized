sudo: required

services:
- docker

before_install:
  - sudo rm /usr/local/bin/docker-compose
  - curl -L https://github.com/docker/compose/releases/download/$(curl -Ls https://www.servercow.de/docker-compose/latest.php)/docker-compose-$(uname -s)-$(uname -m) > docker-compose
  - sudo mv docker-compose /usr/local/bin/docker-compose
  - sudo chmod +x /usr/local/bin/docker-compose

jobs:  
  include:
    - stage: "Build"
      name: "mailcow/acme"
      script:
      - export BUILDCONTAINER=mailcow/acme
      - echo 'Europe/Berlin' | MAILCOW_HOSTNAME=build.mailcow ./generate_config.sh
      - docker login --username=$DOCKER_HUB_USERNAME --password=$DOCKER_HUB_PASSWORD
      - chmod +x ./helper-scripts/travis-ci.sh && ./helper-scripts/travis-ci.sh
    - name: "mailcow/unbound"   
      script:
      - export BUILDCONTAINER=mailcow/unbound
      - echo 'Europe/Berlin' | MAILCOW_HOSTNAME=build.mailcow ./generate_config.sh
      - docker login --username=$DOCKER_HUB_USERNAME --password=$DOCKER_HUB_PASSWORD
      - chmod +x ./helper-scripts/travis-ci.sh && ./helper-scripts/travis-ci.sh
    - name: "mailcow/clamd"   
      script:
      - export BUILDCONTAINER=mailcow/clamd
      - echo 'Europe/Berlin' | MAILCOW_HOSTNAME=build.mailcow ./generate_config.sh
      - docker login --username=$DOCKER_HUB_USERNAME --password=$DOCKER_HUB_PASSWORD
      - chmod +x ./helper-scripts/travis-ci.sh && ./helper-scripts/travis-ci.sh
    - name: "mailcow/rspamd"   
      script:
      - export BUILDCONTAINER=mailcow/rspamd
      - echo 'Europe/Berlin' | MAILCOW_HOSTNAME=build.mailcow ./generate_config.sh
      - docker login --username=$DOCKER_HUB_USERNAME --password=$DOCKER_HUB_PASSWORD
      - chmod +x ./helper-scripts/travis-ci.sh && ./helper-scripts/travis-ci.sh
    - name: "mailcow/phpfpm"
      script:
      - export BUILDCONTAINER=mailcow/phpfpm
      - echo 'Europe/Berlin' | MAILCOW_HOSTNAME=build.mailcow ./generate_config.sh
      - docker login --username=$DOCKER_HUB_USERNAME --password=$DOCKER_HUB_PASSWORD
      - chmod +x ./helper-scripts/travis-ci.sh && ./helper-scripts/travis-ci.sh
    - name: "mailcow/sogo"   
      script:
      - export BUILDCONTAINER=mailcow/sogo
      - echo 'Europe/Berlin' | MAILCOW_HOSTNAME=build.mailcow ./generate_config.sh
      - docker login --username=$DOCKER_HUB_USERNAME --password=$DOCKER_HUB_PASSWORD
      - chmod +x ./helper-scripts/travis-ci.sh && ./helper-scripts/travis-ci.sh
    - name: "mailcow/dovecot"   
      script:
      - export BUILDCONTAINER=mailcow/dovecot
      - echo 'Europe/Berlin' | MAILCOW_HOSTNAME=build.mailcow ./generate_config.sh
      - docker login --username=$DOCKER_HUB_USERNAME --password=$DOCKER_HUB_PASSWORD
      - chmod +x ./helper-scripts/travis-ci.sh && ./helper-scripts/travis-ci.sh
    - name: "mailcow/postfix"   
      script:
      - export BUILDCONTAINER=mailcow/postfix
      - echo 'Europe/Berlin' | MAILCOW_HOSTNAME=build.mailcow ./generate_config.sh
      - docker login --username=$DOCKER_HUB_USERNAME --password=$DOCKER_HUB_PASSWORD
      - chmod +x ./helper-scripts/travis-ci.sh && ./helper-scripts/travis-ci.sh
    - name: "mailcow/netfilter"   
      script:
      - export BUILDCONTAINER=mailcow/netfilter
      - echo 'Europe/Berlin' | MAILCOW_HOSTNAME=build.mailcow ./generate_config.sh
      - docker login --username=$DOCKER_HUB_USERNAME --password=$DOCKER_HUB_PASSWORD
      - chmod +x ./helper-scripts/travis-ci.sh && ./helper-scripts/travis-ci.sh
    - name: "mailcow/watchdog"   
      script:
      - export BUILDCONTAINER=mailcow/watchdog
      - echo 'Europe/Berlin' | MAILCOW_HOSTNAME=build.mailcow ./generate_config.sh
      - docker login --username=$DOCKER_HUB_USERNAME --password=$DOCKER_HUB_PASSWORD
      - chmod +x ./helper-scripts/travis-ci.sh && ./helper-scripts/travis-ci.sh
    - name: "mailcow/dockerapi"   
      script:
      - export BUILDCONTAINER=mailcow/dockerapi
      - echo 'Europe/Berlin' | MAILCOW_HOSTNAME=build.mailcow ./generate_config.sh
      - docker login --username=$DOCKER_HUB_USERNAME --password=$DOCKER_HUB_PASSWORD
      - chmod +x ./helper-scripts/travis-ci.sh && ./helper-scripts/travis-ci.sh
    - name: "mailcow/solr"
      script:
      - export BUILDCONTAINER=mailcow/solr
      - echo 'Europe/Berlin' | MAILCOW_HOSTNAME=build.mailcow ./generate_config.sh
      - docker login --username=$DOCKER_HUB_USERNAME --password=$DOCKER_HUB_PASSWORD
      - chmod +x ./helper-scripts/travis-ci.sh && ./helper-scripts/travis-ci.sh
branches:
  only:
  - master
